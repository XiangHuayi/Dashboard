<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBOPS Deployment Frequency Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üöÄ OBOPS SESAM Dashboard</h1>
        </header>

        <!-- Navigation -->
        <nav class="navigation">
            <button class="nav-btn active" data-view="statistics">üìä Deployment Frequency Statistics</button>
            <button class="nav-btn" data-view="leadtime">‚è±Ô∏è Lead Time for Changes</button>
            <button class="nav-btn" data-view="coverage">üß™ Code Coverage</button>
            <button class="nav-btn" data-view="changefailure">üêõ Change Failure Rate</button>
        </nav>

        <!-- Statistics View -->
        <div id="statisticsView" class="view-container active">
            <!-- Control Panel -->
            <div class="controls">
            <div class="control-group">
                <label for="pipelineSelect">Select Pipeline:</label>
                <select id="pipelineSelect">
                    <option value="">Loading...</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="timeRange">Time Range:</label>
                <select id="timeRange">
                    <option value="7">Last 7 days</option>
                    <option value="15">Last 15 days</option>
                    <option value="30" selected>Last 30 days</option>
                    <option value="60">Last 60 days</option>
                    <option value="90">Last 90 days</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="chartType">Chart Type:</label>
                <select id="chartType">
                    <option value="daily">Daily Statistics</option>
                    <option value="hourly">Hourly Statistics</option>
                    <option value="success-rate">Success Rate Analysis</option>
                </select>
            </div>

            <button id="refreshBtn" class="refresh-btn">üîÑ Refresh Data</button>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-content">
                    <h3 id="totalRuns">-</h3>
                    <p>Total Runs</p>
                </div>
            </div>
            
            <div class="stat-card success">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <h3 id="successRuns">-</h3>
                    <p>Successful Runs</p>
                </div>
            </div>
            
            <div class="stat-card failure">
                <div class="stat-icon">‚ùå</div>
                <div class="stat-content">
                    <h3 id="failureRuns">-</h3>
                    <p>Failed Runs</p>
                </div>
            </div>
            
            <div class="stat-card rate">
                <div class="stat-icon">üìà</div>
                <div class="stat-content">
                    <h3 id="successRate">-</h3>
                    <p>Success Rate</p>
                </div>
            </div>
            
            <div class="stat-card frequency">
                <div class="stat-icon">‚ö°</div>
                <div class="stat-content">
                    <h3 id="deployFrequency">-</h3>
                    <p>Deploy Frequency (per day)</p>
                </div>
            </div>
        </div>

        <!-- Main Chart Area -->
        <div class="chart-container">
            <canvas id="mainChart"></canvas>
        </div>

        <!-- Details Section -->
        <div class="details-section">
            <h2>Recent Runs</h2>
            <div class="table-container">
                <table id="runsTable">
                    <thead>
                        <tr>
                            <th>Run ID</th>
                            <th>Name</th>
                            <th>Status</th>
                            <th>Result</th>
                            <th>Start Time</th>
                            <th>Finish Time</th>
                            <th>Duration</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        </div>

        <!-- Code Coverage View -->
        <div id="coverageView" class="view-container">
            <div class="coverage-header">
                <h2>üß™ Unit Test Code Coverage</h2>
                <button id="refreshCoverageBtn" class="refresh-btn">üîÑ Refresh</button>
            </div>
            <div id="coverageCards" class="coverage-grid">
                <!-- Dynamically generated coverage cards -->
            </div>
        </div>

        <!-- Lead Time for Changes View -->
        <div id="leadtimeView" class="view-container">
            <div class="leadtime-header">
                <h2>‚è±Ô∏è Lead Time for Changes (DORA Metrics)</h2>
                <div class="leadtime-controls">
                    <select id="leadtimeTimeRange">
                        <option value="7">Last 7 days</option>
                        <option value="15">Last 15 days</option>
                        <option value="30" selected>Last 30 days</option>
                        <option value="60">Last 60 days</option>
                        <option value="90">Last 90 days</option>
                    </select>
                    <button id="refreshLeadtimeBtn" class="refresh-btn">üîÑ Refresh</button>
                </div>
            </div>
            
            <!-- Lead Time Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <h3 id="totalPRs">-</h3>
                        <p>Deployment Cycles</p>
                    </div>
                </div>
                
                <div class="stat-card success">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-content">
                        <h3 id="avgLeadTime">-</h3>
                        <p>Average Lead Time</p>
                    </div>
                </div>
                
                <div class="stat-card info">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-content">
                        <h3 id="medianLeadTime">-</h3>
                        <p>Median Lead Time</p>
                    </div>
                </div>
                
                <div class="stat-card warning">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-content">
                        <h3 id="minLeadTime">-</h3>
                        <p>Shortest Lead Time</p>
                    </div>
                </div>
                
                <div class="stat-card failure">
                    <div class="stat-icon">üêå</div>
                    <div class="stat-content">
                        <h3 id="maxLeadTime">-</h3>
                        <p>Longest Lead Time</p>
                    </div>
                </div>
            </div>

            <!-- Lead Time Chart -->
            <div class="chart-container">
                <canvas id="leadtimeChart"></canvas>
            </div>

            <!-- PR List -->
            <div class="details-section">
                <h2>Pull Request List</h2>
                <div class="table-container">
                    <table id="leadtimeTable">
                        <thead>
                            <tr>
                                <th>Cycle</th>
                                <th>Start Deploy PR</th>
                                <th>Start Time</th>
                                <th>End Deploy PR</th>
                                <th>End Time</th>
                                <th>Lead Time (hours)</th>
                                <th>Lead Time (days)</th>
                                <th>PRs in Period</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Change Failure Rate View -->
        <div id="changefailureView" class="view-container">
            <div class="changefailure-header">
                <h2>üêõ Change Failure Rate (DORA Metrics)</h2>
                <div class="changefailure-controls">
                    <select id="changefailureTimeRange">
                        <option value="7">Last 7 days</option>
                        <option value="15">Last 15 days</option>
                        <option value="30" selected>Last 30 days</option>
                        <option value="60">Last 60 days</option>
                        <option value="90">Last 90 days</option>
                    </select>
                    <button id="refreshChangeFailureBtn" class="refresh-btn">üîÑ Refresh</button>
                </div>
            </div>
            
            <!-- Change Failure Rate Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card failure">
                    <div class="stat-icon">üêõ</div>
                    <div class="stat-content">
                        <h3 id="totalBugs">-</h3>
                        <p>Total Failure Bugs</p>
                    </div>
                </div>
                
                <div class="stat-card success">
                    <div class="stat-icon">üöÄ</div>
                    <div class="stat-content">
                        <h3 id="totalDeployments">-</h3>
                        <p>Total Deployments</p>
                    </div>
                </div>
                
                <div class="stat-card warning">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <h3 id="changeFailureRate">-</h3>
                        <p>Change Failure Rate</p>
                    </div>
                </div>
                
                <div class="stat-card info">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-content">
                        <h3 id="cfrPeriod">-</h3>
                        <p>Analysis Period</p>
                    </div>
                </div>
            </div>

            <!-- Change Failure Rate Chart -->
            <div class="chart-container">
                <canvas id="changefailureChart"></canvas>
            </div>

            <!-- Bug Details Section -->
            <div class="details-section">
                <h2>Environment Change Failure Bugs</h2>
                <div class="table-container">
                    <table id="bugsTable">
                        <thead>
                            <tr>
                                <th>Bug ID</th>
                                <th>Title</th>
                                <th>Severity</th>
                                <th>State</th>
                                <th>Assigned To</th>
                                <th>Created Date</th>
                                <th>Tags</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading data...</p>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="error-message" style="display: none;">
            <h3>‚ùå Load Failed</h3>
            <p id="errorText"></p>
            <button onclick="loadData()">Retry</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>